---
# yaml-language-server: $schema=https://github.com/instrumenta/kubernetes-json-schema/raw/refs/heads/master/v1.18.1/ingress.json
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ${AUTHENTIK_PROXY_HOST//./-}-authentik-outpost
spec:
  ingressClassName: "${INGRESS_CLASS:=internal}"
    # Need to add to the Ingress you want to protect
    # https://docs.goauthentik.io/docs/add-secure-apps/providers/proxy/server_nginx
  rules:
    - host: "${AUTHENTIK_PROXY_HOST:=auth}.${SECRET_DOMAIN}"
      http:
        paths:
          - pathType: ImplementationSpecific
            path: "/outpost.goauthentik.io"
            backend:
              # service:
              #   name: authentik-outpost
              #   namespace: default
              #   port:
              #     number: 9000

              # Or, to use an external Outpost, create an ExternalName service and reference that here.
              # See https://kubernetes.io/docs/concepts/services-networking/service/#externalname
              type: ExternalName
              externalName: authentik-server.default.svc.cluster.local